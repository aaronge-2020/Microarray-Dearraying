<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De-arraying Visualization</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="logo">
            <h1>Tissue Segmentation Tool</h1>
        </div>
        <nav>
            <ul>
                <li><a href="./index.html">Core Detection</a></li>
                <li><a href="./gridding.html">Gridding</a></li>
                <li><a href="https://github.com/aaronge-2020/Microarray-Dearraying/">GitHub</a></li>
                <li><a href="#paper">Paper</a></li>
            </ul>
        </nav>
    </header>

    <div class="app-container">
        <div class="sidebar">
            <!-- Form for hyperparameters -->
            <form id="hyperparameters-form">
                <!-- File input section -->
                <div class="file-upload-container">
                    <label for="fileInput" class="file-dropzone">
                        <div class="file-input-btn">Select a file</div>
                        <input type="file" id="fileInput" name="fileInput" hidden>
                        <p>Drop file here</p>
                        <br>
                        <br>

                        <p>OR</p>
                    </label>
                    <br>
                    <label for="jsonUrlInput">Paste in JSON URL:</label>
                    <input type="text" id="jsonUrlInput" placeholder="Enter JSON URL"
                        value="https://raw.githubusercontent.com/aaronge-2020/Microarray-Dearraying/main/TMA_WSI_Labels_updated/158871.json" />
                    <button id="loadJsonBtn" type="button" class="load-json-btn">Load JSON</button>

                    <br>
                </div>

                <!-- Image file input section -->
                <div class="file-upload-container">
                    <label for="imageInput" class="file-dropzone">
                        <div class="file-input-btn">Select an Image File</div>
                        <input type="file" id="imageInput" accept="image/*" hidden>
                        <p>Drop image file here</p>
                        <br>
                        <p>OR</p>
                        <br>
                        <label for="imgUrlInput">Paste in Image URL:</label>
                        <input type="text" id="imgUrlInput" placeholder="Enter Image URL" value="" />
                        <button id="loadImgBtn" type="button" class="load-img-btn">Load Image</button>

                        <br>
                    </label>
                </div>


                <div class="hyperparameters">



                <!-- Hyperparameter form section -->
                    <h2>Hyperparameter Configuration</h2>

                    <!-- Image Parameters Section -->
                    <fieldset>
                        <legend>Image Parameters</legend>
                        <label for="userRadius">Core Radius:</label>
                        <input type="range" id="userRadius" name="userRadius" min="1" max="100" value="20">
                        <output id="radiusValue" for="userRadius">20</output>
                        <!-- X Offset slider section -->

                        <label for="xOffset">X Offset:</label>
                        <input type="range" id="xOffset" name="xOffset" min="-100" max="100" value="0">
                        <output id="xOffsetValue" for="xOffset">0</output>

                        <!-- Y Offset slider section -->

                        <label for="yOffset">Y Offset:</label>
                        <input type="range" id="yOffset" name="yOffset" min="-100" max="100" value="0">
                        <output id="yOffsetValue" for="yOffset">0</output>
                    </fieldset>


                    <!-- Traveling Algorithm Section -->
                    <fieldset>
                        <legend>Traveling Algorithm Parameters</legend>


                        <label for="originAngle" title="Rotation of the image in degrees">Image Rotation</label>
                        <input type="number" id="originAngle" name="originAngle" step="1" value="0">

                        <label for="radiusMultiplier"
                            title="Multiplier for the radius used in the traveling algorithm">Radius Multiplier</label>
                        <input type="number" id="radiusMultiplier" name="radiusMultiplier" step="0.1" value="0.7">

                        <label for="gridWidth" title="Width of one square in the grid used in the traveling algorithm"
                            style="display: none">Grid Width</label>
                        <input type="number" id="gridWidth" name="gridWidth" step="1" value="70" style="display: none">

                        <label for="gamma"
                            title="Distance after the the core with the greatest X value to stop the traveling algorithm">Stopping
                            Distance</label>
                        <input type="number" id="gamma" name="gamma" step="1" value="60">


                        <label for="multiplier"
                            title="Multiplier for the grid width calculation in the traveling algorithm"
                            style="display: none">Multiplier for
                            Grid Width</label>
                        <input type="number" id="multiplier" name="multiplier" step="0.1" value="1.5"
                            style="display: none">

                        <label for="imageWidth" title="Width of the entire gird used in the traveling algorithm">Image
                            Width</label>
                        <input type="number" id="imageWidth" name="imageWidth" step="1" value="1024">

                        <label for="searchAngle" title="Angle to search in the traveling algorithm"
                            style="display: none">Search Angle</label>
                        <input type="number" id="searchAngle" name="searchAngle" step="1" value="360"
                            style="display: none">

                    </fieldset>

                    <!-- Add a button/link for the collapsible dropdown -->
                    <button id="toggle-advanced-settings" type="button">Show Advanced Settings</button>
                    <!-- Wrap hidden fieldsets in a div -->
                    <div id="advanced-settings" style="display: none;">
                        <!-- Edge Detection Section -->
                        <fieldset>
                            <legend>Edge Detection Parameters</legend>


                            <label for="thresholdMultiplier"
                                title="Multiplier for the median absolute deviation to filter edges by length">Length
                                Threshold
                                Multiplier</label>
                            <input type="number" id="thresholdMultiplier" name="thresholdMultiplier" step="0.1"
                                value="1.5">

                            <label for="thresholdAngle"
                                title="The angle within which edges are considered valid">Threshold
                                Angle</label>
                            <input type="number" id="thresholdAngle" name="thresholdAngle" step="1" value="10">
                        </fieldset>

                        <!-- Image Rotation Section -->
                        <fieldset>
                            <legend>Image Rotation Parameters</legend>

                            <label for="minAngle" title="Minimum angle to test for image rotation">Minimum Angle</label>
                            <input type="number" id="minAngle" name="minAngle" step="1" value="0">

                            <label for="maxAngle" title="Maximum angle to test for image rotation">Maximum Angle</label>
                            <input type="number" id="maxAngle" name="maxAngle" step="1" value="360">

                            <label for="angleStepSize"
                                title="Incremental step size for testing angles during image rotation">Angle Step
                                Size</label>
                            <input type="number" id="angleStepSize" name="angleStepSize" step="1" value="5">

                            <label for="angleThreshold"
                                title="Angle threshold used when filtering edges by angle for image rotation">Angle
                                Threshold</label>
                            <input type="number" id="angleThreshold" name="angleThreshold" step="1" value="20">
                        </fieldset>

                    </div>

                    <button type="button" id="apply-hyperparameters">Apply Hyperparameters</button>
                    <br>
                </div>
                <button type="button" id="saveResults">Save Results</button>

            </form>

        </div>
        <div class="content" style="width: 100%; height: 100%">
            <!-- Existing carousel for visualizations -->
            <div id="visualization-carousel" class="carousel" style="width: 100%; height: 100%; display: none;">
                <div id="visualization" style="width: 100%; height: 100%"></div>
            </div>

            <!-- Canvas for displaying and interacting with the image -->
            <canvas id="coreCanvas" width="1024" height="1024" style="border:1px solid #000000;"></canvas>
        </div>


    </div>

    <script type="module" src="main.js"></script>

</body>

</html>